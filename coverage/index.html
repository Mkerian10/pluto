<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code Coverage Report - Pluto</title>
  <script src="https://cdn.jsdelivr.net/npm/list.js@2.3.1/dist/list.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
      background: #f6f8fa;
      color: #24292f;
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .header {
      margin-bottom: 30px;
    }

    .back-link {
      display: inline-block;
      margin-bottom: 15px;
      color: #0969da;
      text-decoration: none;
      font-weight: 500;
      font-size: 14px;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    h1 {
      font-size: 32px;
      font-weight: 600;
      color: #24292f;
      margin-bottom: 8px;
    }

    .subtitle {
      color: #57606a;
      font-size: 14px;
    }

    /* Summary Cards */
    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }

    .summary-card {
      background: white;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      padding: 16px 20px;
    }

    .summary-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: #57606a;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .summary-value {
      font-size: 28px;
      font-weight: 600;
      color: #24292f;
    }

    .summary-unit {
      font-size: 16px;
      color: #57606a;
    }

    /* Search */
    .controls {
      background: white;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .search-box {
      width: 100%;
      max-width: 400px;
      padding: 8px 12px;
      font-size: 14px;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      outline: none;
    }

    .search-box:focus {
      border-color: #0969da;
      box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.1);
    }

    /* Table */
    .table-container {
      background: white;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      overflow: hidden;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      background: #f6f8fa;
      border-bottom: 1px solid #d0d7de;
    }

    th {
      padding: 12px 16px;
      text-align: left;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: #57606a;
      letter-spacing: 0.5px;
      cursor: pointer;
      user-select: none;
    }

    th:hover {
      background: #eaeef2;
    }

    th.sort {
      position: relative;
    }

    th.sort::after {
      content: '‚áÖ';
      position: absolute;
      right: 8px;
      opacity: 0.3;
    }

    th.asc::after {
      content: '‚Üë';
      opacity: 1;
    }

    th.desc::after {
      content: '‚Üì';
      opacity: 1;
    }

    tbody tr {
      border-bottom: 1px solid #d0d7de;
    }

    tbody tr:last-child {
      border-bottom: none;
    }

    tbody tr:hover {
      background: #f6f8fa;
    }

    td {
      padding: 12px 16px;
      font-size: 14px;
    }

    .filename {
      font-family: 'SF Mono', Monaco, 'Cascadia Code', Consolas, monospace;
      font-size: 13px;
      color: #0969da;
    }

    .coverage-cell {
      font-weight: 600;
      font-variant-numeric: tabular-nums;
    }

    .coverage-high { color: #1a7f37; }
    .coverage-medium { color: #bf8700; }
    .coverage-low { color: #cf222e; }

    .count {
      color: #57606a;
      font-size: 13px;
      font-variant-numeric: tabular-nums;
    }

    /* Empty State */
    .no-results {
      text-align: center;
      padding: 60px 20px;
      color: #57606a;
    }

    .no-results-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.3;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <a href="../" class="back-link">‚Üê Back to Dashboard</a>
      <h1>Code Coverage Report</h1>
      <p class="subtitle">Unit test coverage ‚Ä¢ Generated by cargo-llvm-cov</p>
    </div>

    <div class="summary" id="summary">
      <div class="summary-card">
        <div class="summary-label">Line Coverage</div>
        <div class="summary-value"><span id="total-line-coverage">--</span><span class="summary-unit">%</span></div>
      </div>
      <div class="summary-card">
        <div class="summary-label">Function Coverage</div>
        <div class="summary-value"><span id="total-function-coverage">--</span><span class="summary-unit">%</span></div>
      </div>
      <div class="summary-card">
        <div class="summary-label">Region Coverage</div>
        <div class="summary-value"><span id="total-region-coverage">--</span><span class="summary-unit">%</span></div>
      </div>
      <div class="summary-card">
        <div class="summary-label">Files Covered</div>
        <div class="summary-value"><span id="files-count">--</span></div>
      </div>
    </div>

    <div class="controls">
      <input class="search-box search" placeholder="Search files..." type="text">
    </div>

    <div class="table-container">
      <table id="coverage-table">
        <thead>
          <tr>
            <th class="sort" data-sort="filename">File</th>
            <th class="sort" data-sort="line-percent">Lines</th>
            <th class="sort" data-sort="line-count">Lines Covered</th>
            <th class="sort" data-sort="function-percent">Functions</th>
            <th class="sort" data-sort="function-count">Functions Covered</th>
            <th class="sort" data-sort="region-percent">Regions</th>
            <th class="sort" data-sort="region-count">Regions Covered</th>
          </tr>
        </thead>
        <tbody class="list">
          <!-- Populated by JavaScript -->
        </tbody>
      </table>
      <div class="no-results" style="display: none;">
        <div class="no-results-icon">üîç</div>
        <p>No files found matching your search</p>
      </div>
    </div>
  </div>

  <script>
    // Load and parse coverage data
    fetch('coverage.json')
      .then(response => response.json())
      .then(data => {
        const files = data.data[0].files;

        // Calculate totals
        let totalLines = 0, coveredLines = 0;
        let totalFunctions = 0, coveredFunctions = 0;
        let totalRegions = 0, coveredRegions = 0;

        const items = files.map(file => {
          const filename = file.filename.replace(/.*\/src\//, 'src/');
          const summary = file.summary;

          totalLines += summary.lines.count;
          coveredLines += summary.lines.covered;
          totalFunctions += summary.functions.count;
          coveredFunctions += summary.functions.covered;
          totalRegions += summary.regions.count;
          coveredRegions += summary.regions.covered;

          return {
            filename: filename,
            'line-percent': summary.lines.percent.toFixed(1),
            'line-count': `${summary.lines.covered}/${summary.lines.count}`,
            'line-percent-raw': summary.lines.percent,
            'function-percent': summary.functions.percent.toFixed(1),
            'function-count': `${summary.functions.covered}/${summary.functions.count}`,
            'function-percent-raw': summary.functions.percent,
            'region-percent': summary.regions.percent.toFixed(1),
            'region-count': `${summary.regions.covered}/${summary.regions.count}`,
            'region-percent-raw': summary.regions.percent
          };
        });

        // Update summary
        document.getElementById('total-line-coverage').textContent =
          ((coveredLines / totalLines) * 100).toFixed(1);
        document.getElementById('total-function-coverage').textContent =
          ((coveredFunctions / totalFunctions) * 100).toFixed(1);
        document.getElementById('total-region-coverage').textContent =
          ((coveredRegions / totalRegions) * 100).toFixed(1);
        document.getElementById('files-count').textContent = files.length;

        // Helper to get coverage class
        function getCoverageClass(percent) {
          if (percent >= 80) return 'coverage-high';
          if (percent >= 50) return 'coverage-medium';
          return 'coverage-low';
        }

        // Initialize List.js
        const options = {
          valueNames: [
            'filename',
            { name: 'line-percent', attr: 'data-value' },
            'line-count',
            { name: 'function-percent', attr: 'data-value' },
            'function-count',
            { name: 'region-percent', attr: 'data-value' },
            'region-count'
          ],
          item: function(values) {
            return `
              <tr>
                <td class="filename">${values.filename}</td>
                <td class="coverage-cell ${getCoverageClass(values['line-percent-raw'])}" data-value="${values['line-percent']}">${values['line-percent']}%</td>
                <td class="count">${values['line-count']}</td>
                <td class="coverage-cell ${getCoverageClass(values['function-percent-raw'])}" data-value="${values['function-percent']}">${values['function-percent']}%</td>
                <td class="count">${values['function-count']}</td>
                <td class="coverage-cell ${getCoverageClass(values['region-percent-raw'])}" data-value="${values['region-percent']}">${values['region-percent']}%</td>
                <td class="count">${values['region-count']}</td>
              </tr>
            `;
          }
        };

        const coverageList = new List('coverage-table', options, items);

        // Show/hide no results message
        coverageList.on('searchComplete', function() {
          const noResults = document.querySelector('.no-results');
          const table = document.querySelector('table');
          if (coverageList.visibleItems.length === 0) {
            noResults.style.display = 'block';
            table.style.display = 'none';
          } else {
            noResults.style.display = 'none';
            table.style.display = 'table';
          }
        });
      })
      .catch(error => {
        console.error('Error loading coverage data:', error);
        document.querySelector('.table-container').innerHTML =
          '<div class="no-results"><div class="no-results-icon">‚ö†Ô∏è</div><p>Error loading coverage data</p></div>';
      });
  </script>
</body>
</html>
